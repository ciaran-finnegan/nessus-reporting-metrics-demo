CREATE TABLE vulnerabilities (
    id SERIAL PRIMARY KEY, -- Unique identifier for the vulnerability record
    Asset_Name VARCHAR NOT NULL, -- The name of the asset this vulnerability is associated with
    Vulnerability_Name VARCHAR NOT NULL, -- The human-readable name or title of the vulnerability
    Status VARCHAR, -- The current status of the vulnerability (e.g., Open, Closed, In Progress, Accepted Risk)
    Risk VARCHAR, -- The overall risk level or category assigned to the vulnerability
    Sources TEXT, -- JSON array of connectors or sources that detected this vulnerability
    Risk_Score FLOAT, -- The calculated risk score for the vulnerability, which may differ from CVSS score
    CVSS_Score FLOAT, -- The CVSS (Common Vulnerability Scoring System) score, indicating severity
    First_Seen TIMESTAMP, -- The first date and time the vulnerability was observed on the asset
    Last_Seen TIMESTAMP, -- The last date and time the vulnerability was observed or confirmed on the asset
    Threats TEXT, -- JSON array of threat tags or threat intelligence indicators associated with this vulnerability
    CVE VARCHAR, -- The CVE (Common Vulnerabilities and Exposures) identifier, if available
    Vulnerability_Description TEXT, -- Detailed description of the vulnerability and its impact
    Vulnerability_Instance_Details TEXT, -- Specific details about this instance of the vulnerability on the particular asset
    Scanner_Resolution TEXT, -- Resolution or remediation guidance provided by the scanner that detected the vulnerability
    Tags TEXT, -- JSON array of custom tags or labels assigned to the vulnerability for categorisation and filtering
    Business_Groups TEXT, -- JSON array of business groups or organisational units responsible for or associated with this vulnerability
    Owners TEXT, -- JSON array of dynamic properties indicating the owners or responsible parties for addressing this vulnerability
    Inclusion_Date TIMESTAMP, -- The date when this vulnerability was included or imported into the vulnerability management system
    OS VARCHAR, -- Operating system of the asset where the vulnerability was found
    OS_Version VARCHAR, -- Version of the operating system where the vulnerability was found
    IP VARCHAR, -- IP address of the asset where the vulnerability was found
    Cloud_Instance_ID VARCHAR, -- Cloud instance identifier if the vulnerability is found on a cloud-based asset
    CWE VARCHAR, -- The CWE (Common Weakness Enumeration) identifier, if available
    Solution TEXT, -- Recommended solution or remediation steps for the vulnerability
    Severity VARCHAR, -- The severity level of the vulnerability (e.g., Critical, High, Medium, Low)
    Scanner VARCHAR, -- The scanner or tool that detected the vulnerability
    Port INTEGER, -- The port number associated with the vulnerability, if applicable
    Protocol VARCHAR, -- The protocol associated with the vulnerability (e.g., TCP, UDP)
    Service VARCHAR, -- The service running on the port where the vulnerability was found
    Exploit_Available BOOLEAN, -- Whether an exploit is available for this vulnerability
    Patch_Available BOOLEAN, -- Whether a patch is available for this vulnerability
    Remediation_Effort VARCHAR, -- The estimated effort required to remediate the vulnerability
    Business_Impact VARCHAR, -- The potential business impact of the vulnerability
    Compliance_Impact VARCHAR, -- The impact on compliance requirements if the vulnerability is not addressed
    Asset_Criticality VARCHAR, -- The criticality level of the affected asset
    Network_Access VARCHAR, -- The network access level required to exploit the vulnerability
    Authentication_Required VARCHAR, -- Whether authentication is required to exploit the vulnerability
    User_Interaction VARCHAR -- Whether user interaction is required to exploit the vulnerability
);

-- Comprehensive vulnerability schema including all fields from CSV examples, documentation, and PDF field list
-- Indexes for common query patterns
CREATE INDEX idx_vulnerabilities_asset_name ON vulnerabilities(Asset_Name);
CREATE INDEX idx_vulnerabilities_status ON vulnerabilities(Status);
CREATE INDEX idx_vulnerabilities_risk_score ON vulnerabilities(Risk_Score);
CREATE INDEX idx_vulnerabilities_cvss_score ON vulnerabilities(CVSS_Score);
CREATE INDEX idx_vulnerabilities_first_seen ON vulnerabilities(First_Seen);
CREATE INDEX idx_vulnerabilities_last_seen ON vulnerabilities(Last_Seen);
CREATE INDEX idx_vulnerabilities_severity ON vulnerabilities(Severity);
CREATE INDEX idx_vulnerabilities_cve ON vulnerabilities(CVE); 